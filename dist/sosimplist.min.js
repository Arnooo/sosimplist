/*! sosimplist v0.2.0 2016-01-15 */
function ElementFactory_create(){return new sosimplist.ElementFactory}function ItemFactory_create(){return new sosimplist.ItemFactory}function Sosimplist_create(){return new sosimplist.Manager}var sosimplist={};sosimplist.stringToFunction=function(a){for(var b=a.split("."),c=window||this,d=0,e=b.length;e>d;d++)c=c[b[d]];if("function"!=typeof c)throw new Error("function not found");return c},sosimplist.updateOptions=function(a,b){var c=a;if(b)for(var d in b){if(void 0===c[d])throw new Error("Option = "+d+" in newOptions["+d+"] = "+b[d]+", does not exist in this version!");!(c[d]instanceof Array)&&c[d]instanceof Object?c[d]=sosimplist.updateOptions(c[d],b[d]):c[d]=b[d]}return c};var E_DB_SERVICE={NONE:"none",URL:"url",FIREBASE:"firebase"};sosimplist.databaseModule=null,sosimplist.DefaultDatabaseModule=function(a){var b=this;b.dbParams_=a},sosimplist.DefaultDatabaseModule.prototype.get=function(a){var b=this,c=null;if(b.dbParams_.dbService===E_DB_SERVICE.URL){var d=window.location.href.split("#");d[1]&&(c=atob(d[1]))}else b.dbParams_.dbService===E_DB_SERVICE.FIREBASE||b.dbParams_.dbData&&b.dbParams_.dbData.length>0&&(c=JSON.stringify(b.dbParams_.dbData));return c},sosimplist.DefaultDatabaseModule.prototype.set=function(a){var b=this;b.dbParams_.dbService===E_DB_SERVICE.URL?window.location.href=window.location.href.split("#")[0]+"#"+btoa(a):b.dbParams_.dbService===E_DB_SERVICE.FIREBASE},sosimplist.ElementFactory=function(){},sosimplist.ElementFactory.prototype.create=function(a,b){if("selector"===a){var c=document.createElement("div");return c.className="sosimplist-item-selector",c}if("checkbox"===a){var d=document.createElement("input");return d.className="sosimplist-item-checkbox",d.type="checkbox",d.checked=b.checked,d.addEventListener("change",b.change,!1),d}if("text"===a){var e=document.createElement("div");return e.id=b.id,e.className=b.className+" sosimplist-editable",b.edit?e.contentEditable=!0:e.className+=" sosimplist-edit-false",e.setAttribute("placeholder",b.placeholder),e.addEventListener("keyup",b.keyup,!1),e.addEventListener("keydown",sosimplist.EventStrategy.key.enter.stop,!1),e.addEventListener("keypress",sosimplist.EventStrategy.key.enter.stop,!1),e.innerHTML=b.text,e}if("delete"===a){var f=document.createElement("div");return f.className="sosimplist-item-delete",f.addEventListener("click",b.click,!1),f}if("image"===a){var g=document.createElement("img");if(g.className="sosimplist-list-image",g.style.display="table-cell",g.src=b.src,"top"===b.position||"bottom"===b.position){var h=document.createElement("div");return h.style.display="table-row",h.className="sosimplist-list-row",h.appendChild(g),h}return g.style.height="100%",g}if("button"===a){var i=document.createElement("input");return i.type="button",i.className="sosimplist-button",i.id=b.id,i.value=b.value,i.addEventListener("click",b.click,!1),i}console.error("Element type = "+a+" not supported yet !")},sosimplist.elementfactory=ElementFactory_create(),sosimplist.EventStrategy={key:{enter:{stop:function(a,b){13===a.keyCode&&(a.preventDefault(),a.stopPropagation(),b&&b())}},not:{enter:{"do":function(a,b){13!==a.keyCode&&b&&b()}}}},dragstart:function(a,b){var c=null;if(a.target.classList.contains(b.source)){var d=a.target.closest(b.closest);d.style.zIndex=1,d.style.boxShadow="3px 3px 3px grey",c={elementId:d.id,source:b.source};var e=document.createElement("div");e.id="mask",e.style.backgroundColor="red",e.style.opacity=0,e.style.width=d.clientWidth,e.style.height=d.clientHeight,e.style.cursor="move",document.body.appendChild(e),a.dataTransfer.setDragImage(e,0,0)}return c},dragenter:function(a,b,c){if(a.preventDefault(),b&&b.source===c.source){var d=document.getElementById(b.elementId),e=a.target.closest(c.closest);if(d&&e){var f=e.parentNode.contains(d);f&&(d.nextSibling===e?d.parentNode.insertBefore(d,e.nextSibling):d.parentNode.insertBefore(d,e))}}},drop:function(a,b,c){if(b&&b.source===c.source){var d=document.getElementById(b.elementId);d&&(document.body.removeChild(document.getElementById("mask")),d.style.boxShadow="",d.style.zIndex="0")}}},sosimplist.ItemBase=function(a,b){var c=this;c.parent_=a,c.options_=b,c.id_="sosimplist-item"+(new Date).getTime(),c.checked_=!1,c.text_="",c.view_=null},sosimplist.ItemBase.prototype.buildBase=function(){var a=this;if(null===a.view_){a.view_=document.createElement("div"),a.view_.id=a.id_,a.view_.className="sosimplist-item";var b=[],c=sosimplist.elementfactory.create("checkbox",{checked:a.checked_,change:function(){a.check_(this.checked),a.parent_&&a.parent_.dispatch("moveItem",a)}});b.push(c);var d=sosimplist.elementfactory.create("text",{id:"sosimplist-item-text"+a.id_,className:"sosimplist-item-text",keyup:function(b){var c=this;sosimplist.EventStrategy.key.not.enter["do"](b,function(){a.text_=c.innerHTML})},text:a.text_,placeholder:sosimplist.translate("write something"),edit:a.options_.edit});if(b.push(d),a.options_.edit){b.unshift(sosimplist.elementfactory.create("selector"));var e=sosimplist.elementfactory.create("delete",{click:function(){a.parent_&&a.parent_.dispatch("removeItem",a)}});b.push(e),a.view_.addEventListener("keyup",function(b){sosimplist.EventStrategy.key.enter.stop(b,function(){a.parent_&&a.parent_.dispatch("insertItemAfter",a)})},!1),a.view_.addEventListener("keydown",sosimplist.EventStrategy.key.enter.stop,!1),a.view_.addEventListener("keypress",sosimplist.EventStrategy.key.enter.stop,!1)}for(var f=0;f<b.length;f++)a.view_.appendChild(b[f]);a.check_(a.checked_)}else console.error("Item base ID = "+a.id_+", View already builded !")},sosimplist.ItemBase.prototype.serializeBase=function(){var a=this,b={checked:a.checked_,text:a.text_};return b},sosimplist.ItemBase.prototype.unserializeBase=function(a){try{if(!a)throw new Error("Input obj = "+a+", does not contain data to unserialize!");var b=this;b.id_=a.id_,b.checked_=a.checked,b.text_=a.text}catch(c){console.error(c.name+": "+c.message)}},sosimplist.ItemBase.prototype.getView=function(){return this.view_},sosimplist.ItemBase.prototype.getId=function(){return this.id_},sosimplist.ItemBase.prototype.isChecked=function(){return this.checked_},sosimplist.ItemBase.prototype.focus=function(){try{var a=this,b=document.getElementById("sosimplist-item-text"+a.id_),c=document.createRange(),d=window.getSelection();c.setStart(b,0),c.collapse(!0),d.removeAllRanges(),d.addRange(c),b.focus()}catch(e){console.error(e.name+": "+e.message)}},sosimplist.ItemBase.prototype.check_=function(a){try{var b=this;if(a!==!0&&a!==!1)throw new Error("check = "+a+", cannot set this value!");if(b.checked_=a,b.options_.edit){if(!(b.view_&&b.view_.getElementsByClassName("sosimplist-item-selector")&&b.view_.getElementsByClassName("sosimplist-item-selector")[0]))throw new Error("The view = "+b.view_+" is not initialized correctly!");b.view_.draggable=!b.checked_,b.view_.draggable?b.view_.getElementsByClassName("sosimplist-item-selector")[0].style.visibility="visible":b.view_.getElementsByClassName("sosimplist-item-selector")[0].style.visibility="hidden"}}catch(c){console.error(c.name+": "+c.message)}},sosimplist.ItemFactory=function(){},sosimplist.ItemFactory.prototype.create=function(a,b,c){return"ItemText"===a?new sosimplist.ItemText(b,c):"ItemTextComment"===a?new sosimplist.ItemTextComment(b,c):void console.error("Item type = "+a+" not supported yet !")},sosimplist.itemfactory=ItemFactory_create(),sosimplist.ItemText=function(a,b){sosimplist.ItemBase.apply(this,arguments)},sosimplist.ItemText.prototype=new sosimplist.ItemBase,sosimplist.ItemText.prototype.buildView=function(){var a=this;a.buildBase()},sosimplist.ItemText.prototype.serialize=function(){var a=this;return dataSerialized=a.serializeBase(),dataSerialized.type="Text",dataSerialized},sosimplist.ItemText.prototype.unserialize=function(a){var b=this;b.unserializeBase(a)},sosimplist.ItemTextComment=function(a,b){var c=this;sosimplist.ItemBase.apply(this,arguments),c.comment_=""},sosimplist.ItemTextComment.prototype=new sosimplist.ItemBase,sosimplist.ItemTextComment.prototype.buildView=function(){var a=this;a.buildBase();var b=a.view_;if(b){var c=sosimplist.elementfactory.create("text",{id:a.id_,className:"sosimplist-item-text",keyup:function(b){var c=this;sosimplist.EventStrategy.key.not.enter["do"](b,function(){a.comment_=c.innerHTML})},text:a.comment_,placeholder:"write a comment",edit:a.options_.edit});a.options_.edit?b.insertBefore(c,b.lastChild):b.appendChild(c)}else console.error("Item simple ID = "+a.id_+", View already builded !")},sosimplist.ItemTextComment.prototype.serialize=function(){var a=this,b=a.serializeBase();return b.comment=a.comment_,b.type="TextComment",b},sosimplist.ItemTextComment.prototype.unserialize=function(a){try{if(!a)throw new Error("Input obj = "+a+", does not contain data to unserialize!");var b=this;b.unserializeBase(a),b.comment_=a.comment}catch(c){console.error(c.name+": "+c.message)}},sosimplist.List=function(a){var b=this;b.options_=a,b.id_="sosimplist-list"+(new Date).getTime(),b.view_=null,b.title_="",b.image_=null,b.mapOfItem_={},b.checkedVisible_=!1,b.dropdownButtonVisible_=!1,b.dragData=null,b.addItem()},sosimplist.List.prototype.buildView=function(){try{var a=this;if(null===a.view_){a.view_=document.createElement("div"),a.view_.id=a.id_,a.view_.className="sosimplist-list",a.view_.style.display="table",a.options_.edit?a.view_.draggable=!1:a.view_.className+=" sosimplist-edit-false";var b=document.createElement("div");if(b.className="sosimplist-list-content",b.style.display="table-cell",a.image_){var c=sosimplist.elementfactory.create("image",{position:a.image_.position,src:a.image_.src});"bottom"===a.image_.position||"right"===a.image_.position?(a.view_.appendChild(b),a.view_.appendChild(c)):(a.view_.appendChild(c),a.view_.appendChild(b))}else a.view_.appendChild(b);var d=sosimplist.elementfactory.create("text",{id:"sosimplist-title"+a.id_,className:"sosimplist-title",keyup:function(b){var c=this;sosimplist.EventStrategy.key.enter.stop(b),sosimplist.EventStrategy.key.not.enter["do"](b,function(){a.title_=c.innerHTML})},text:a.title_,placeholder:sosimplist.translate("Title"),edit:a.options_.edit});if(b.appendChild(d),a.itemContainer_=document.createElement("div"),a.itemContainer_.className="sosimplist-container-item",a.itemContainer_.addEventListener("dragstart",function(b){a.dragData=sosimplist.EventStrategy.dragstart(b,{source:"sosimplist-item",closest:".sosimplist-item"})},!1),a.itemContainer_.addEventListener("dragenter",function(b){sosimplist.EventStrategy.dragenter(b,a.dragData,{source:"sosimplist-item",closest:".sosimplist-item"})},!1),a.itemContainer_.addEventListener("drop",function(b){sosimplist.EventStrategy.drop(b,a.dragData,{source:"sosimplist-item"})},!1),a.itemContainer_.addEventListener("dragover",function(a){a.preventDefault()},!1),b.appendChild(a.itemContainer_),a.options_.edit){var e=sosimplist.elementfactory.create("button",{id:"sosimplist-button-add-item",value:sosimplist.translate("Add item"),click:function(){a.addItem()}});b.appendChild(e)}var f=document.createElement("div");f.className="sosimplist-list-dropdown-checked",f.value="click",f.addEventListener("click",function(){a.checkedVisible_=!a.checkedVisible_,a.setVisibility_()},!1);var g=document.createElement("div");g.className="sosimplist-list-pin",f.appendChild(g);var h=document.createElement("label");h.className="sosimplist-list-pin-label",h.innerHTML=sosimplist.translate("Selected items"),f.appendChild(h),b.appendChild(f),a.itemContainerChecked_=document.createElement("div"),a.itemContainerChecked_.className="sosimplist-container-item-checked",b.appendChild(a.itemContainerChecked_);for(var i in a.mapOfItem_)a.mapOfItem_[i].isChecked()?a.itemContainerChecked_.appendChild(a.mapOfItem_[i].getView()):a.itemContainer_.appendChild(a.mapOfItem_[i].getView());a.setVisibility_()}else console.error("List ID = "+a.id_+", View already builded !")}catch(j){console.error(j.name+": "+j.message)}},sosimplist.List.prototype.serialize=function(){try{for(var a=this,b={title:a.title_,image:a.image_,items:[]},c=0;c<a.itemContainer_.children.length;c++)b.items.push(a.mapOfItem_[a.itemContainer_.children[c].id].serialize());for(var d=0;d<a.itemContainerChecked_.children.length;d++)b.items.push(a.mapOfItem_[a.itemContainerChecked_.children[d].id].serialize());return b}catch(e){console.error(e.name+": "+e.message)}},sosimplist.List.prototype.unserialize=function(a){try{var b=this;b.id_=a.id_,b.title_=a.title,b.image_=a.image,b.mapOfItem_={};for(var c=0;c<a.items.length;c++){var d=sosimplist.itemfactory.create("Item"+a.items[c].type,b,b.options_);a.items[c].id_=a.items[c].id_?a.items[c].id_:d.getId()+c,d.unserialize(a.items[c]),d.buildView(),b.mapOfItem_[d.getId()]=d}}catch(e){console.error(e.name+": "+e.message)}},sosimplist.List.prototype.getId=function(){return this.id_},sosimplist.List.prototype.addItem=function(a){try{var b=this,c=sosimplist.itemfactory.create("ItemText",b,b.options_);c.buildView(),b.mapOfItem_[c.getId()]=c,null!==b.view_&&(a?b.itemContainer_.insertBefore(c.getView(),a.nextSibling):b.itemContainer_.appendChild(c.getView()),c.focus())}catch(d){console.error(d.name+": "+d.message)}},sosimplist.List.prototype.removeItem=function(a){try{var b=this;b.itemContainer_.contains(document.getElementById(a.getId()))?b.itemContainer_.removeChild(document.getElementById(a.getId())):b.itemContainerChecked_.removeChild(document.getElementById(a.getId())),b.mapOfItem_[a.getId()]=void 0,delete b.mapOfItem_[a.getId()],b.setVisibility_()}catch(c){console.error(c.name+": "+c.message)}},sosimplist.List.prototype.moveItem=function(a){try{var b=this;a.isChecked()?b.itemContainerChecked_.appendChild(document.getElementById(a.getId())):b.itemContainer_.appendChild(document.getElementById(a.getId())),b.setVisibility_()}catch(c){console.error(c.name+": "+c.message)}},sosimplist.List.prototype.insertItemAfter=function(a){try{var b=this;b.addItem(document.getElementById(a.getId()))}catch(c){console.error(c.name+": "+c.message)}},sosimplist.List.prototype.dispatch=function(a,b){try{var c=this;"moveItem"===a?c.moveItem(b):"removeItem"===a?c.removeItem(b):"insertItemAfter"===a&&c.insertItemAfter(b)}catch(d){console.error(d.name+": "+d.message)}},sosimplist.List.prototype.getView=function(){return this.view_},sosimplist.List.prototype.setVisibility_=function(){try{var a=this;a.checkedVisible_?(a.view_.getElementsByClassName("sosimplist-container-item-checked")[0].style.display="",setTimeout(function(){a.view_.getElementsByClassName("sosimplist-container-item-checked")[0].style.opacity="1"},10),a.view_.getElementsByClassName("sosimplist-list-pin")[0].style.transform="rotate(90deg)"):(a.view_.getElementsByClassName("sosimplist-container-item-checked")[0].style.opacity="0",a.view_.getElementsByClassName("sosimplist-container-item-checked")[0].style.display="none",a.view_.getElementsByClassName("sosimplist-list-pin")[0].style.transform=""),a.dropdownButtonVisible_=a.itemContainerChecked_.hasChildNodes(),a.dropdownButtonVisible_?a.view_.getElementsByClassName("sosimplist-list-dropdown-checked")[0].style.display="":a.view_.getElementsByClassName("sosimplist-list-dropdown-checked")[0].style.display="none"}catch(b){console.error(b.name+": "+b.message)}},sosimplist.Manager=function(){var a=this;a.sosimplistId_=(new Date).getTime(),a.viewId_="",a.view_=null,a.mapOfList_={},a.options_={translationModule:"sosimplist.DefaultTranslationModule",databaseModule:"sosimplist.DefaultDatabaseModule",dbParams:{dbService:E_DB_SERVICE.NONE,dbName:null,dbUser:null,dbPassword:null,dbData:[]},lang:"en",edit:!0,checkable:!0},a.dragData=null},sosimplist.Manager.prototype.init=function(a,b){try{var c=this;if(null===c.view_){c.viewId_=a,c.options_=sosimplist.updateOptions(c.options_,b),sosimplist.translationModule=c.loadModule_(c.options_.translationModule,{lang:c.options_.lang}),sosimplist.databaseModule=c.loadModule_(c.options_.databaseModule,c.options_.dbParams);var d=sosimplist.databaseModule.get("data");c.unserialize(d),c.view_=document.getElementById(this.viewId_),c.view_&&c.view_.children.length>0&&console.warning("Sosimplist will append all lists at the end of the element ID = '"+c.viewId_+"'!"),c.view_.className+="sosimplist",c.view_.addEventListener("keyup",function(){sosimplist.databaseModule.set(c.serialize())},!1),c.view_.addEventListener("change",function(){sosimplist.databaseModule.set(c.serialize())},!1),c.view_.addEventListener("click",function(){sosimplist.databaseModule.set(c.serialize())},!1),c.view_.addEventListener("dragend",function(){sosimplist.databaseModule.set(c.serialize())},!1),c.listContainer_=document.createElement("div"),c.listContainer_.id="sosimplist-container-list"+c.sosimplistId_,c.listContainer_.className="sosimplist-container-list",c.listContainer_.addEventListener("dragstart",function(a){c.dragData=sosimplist.EventStrategy.dragstart(a,{source:"sosimplist-list",closest:".sosimplist-list"})},!1),c.listContainer_.addEventListener("dragenter",function(a){sosimplist.EventStrategy.dragenter(a,c.dragData,{source:"sosimplist-list",closest:".sosimplist-list"})},!1),c.listContainer_.addEventListener("drop",function(a){sosimplist.EventStrategy.drop(a,c.dragData,{source:"sosimplist-list"})},!1),c.listContainer_.addEventListener("dragover",function(a){a.preventDefault()},!1),c.view_.appendChild(c.listContainer_);for(var e in c.mapOfList_)c.listContainer_.appendChild(c.mapOfList_[e].getView());if(c.options_.edit){var f=sosimplist.elementfactory.create("button",{id:"sosimplist-button-add-list",value:sosimplist.translate("Add list"),click:function(){c.addList()}});c.view_.appendChild(f);var g=sosimplist.elementfactory.create("button",{id:"sosimplist-button-clear",value:sosimplist.translate("Clear"),click:function(){c.clearAll()}});c.view_.appendChild(g)}}else console.error("Sosimplist ID = "+c.viewId_+", View already builded !")}catch(h){console.error(h.name+": "+h.message)}},sosimplist.Manager.prototype.serialize=function(){var a=this,b=[];for(var c in a.mapOfList_)b.push(a.mapOfList_[c].serialize());return JSON.stringify(b)},sosimplist.Manager.prototype.unserialize=function(a){try{var b=this;if(!a)throw new Error("Cannot unserialize empty data");var c=JSON.parse(a);b.mapOfList_={};for(var d=0;d<c.length;d++){var e=new sosimplist.List(b.options_);c[d].id_=c[d].id_?c[d].id_:e.getId()+d,e.unserialize(c[d]),e.buildView(),b.mapOfList_[e.getId()]=e}}catch(f){console.error(f.name+": "+f.message)}},sosimplist.Manager.prototype.addList=function(){try{var a=this,b=new sosimplist.List(a.options_);b.buildView(),a.listContainer_.appendChild(b.getView()),a.mapOfList_[b.getId()]=b}catch(c){console.error(c.name+": "+c.message)}},sosimplist.Manager.prototype.clearAll=function(){try{var a=this;a.mapOfList_={};for(var b=document.getElementById("sosimplist-container-list"+a.sosimplistId_);b.firstChild;)b.removeChild(b.firstChild);a.updateLocation_()}catch(c){console.error(c.name+": "+c.message)}},sosimplist.Manager.prototype.getView=function(){return this.view_},sosimplist.Manager.prototype.getId=function(){return this.viewId_},sosimplist.Manager.prototype.loadModule_=function(a,b){if(a){var c=sosimplist.stringToFunction(a);return new c(b)}return null},sosimplist.mgr=Sosimplist_create(),sosimplist.init=function(a,b){var c=this;c.mgr.init(a,b)},sosimplist.translationModule=null,sosimplist.DefaultTranslationModule=function(a){var b=this;b.lang_=a.lang,b.text_={fr:{Title:"Titre","Add item":"Ajouter une élément","Selected items":"Eléments sélectionnés","Add list":"Ajouter une liste",Clear:"Tout supprimer"}}},sosimplist.DefaultTranslationModule.prototype.translate=function(a){var b=this;return b.text_&&b.text_[b.lang_]&&b.text_[b.lang_][a]?b.text_[b.lang_][a]:a},sosimplist.translate=function(a){var b=this;return b.translationModule?b.translationModule.translate(a):a};